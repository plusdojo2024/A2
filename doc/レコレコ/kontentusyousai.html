<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>コンテンツ詳細|レコレコ</title>
    <link rel="stylesheet" href="css/test.css">
    <link rel="stylesheet" href="common.css">


</head>

<body>
    <header>
        <nav class="nav">
            <ul>
                <li>
                    <h1><a href="/A2/HomeServlet">レコレコ</a></h1>
                </li>
                <li>
                    <form action="/A2/SearchServlet" class="search-form" method="post">
                        <div class="search-box">
                            <select name="select">
                                <option value="all">すべて</option>
                                <option value="movie">映画</option>
                                <option value="dorama">ドラマ</option>
                                <option value="anime">アニメ</option>
                                <option value="sonota1">その他（映像）</option>
                                <option value="novel">小説</option>
                                <option value="comics">マンガ</option>
                                <option value="sonota2">その他（書籍）</option>
                                <option value="game">ゲーム</option>
                            </select>
                            <input type="text" name="search" class="search-input" placeholder="コンテンツ名・キーワードで検索">
                            <input type="image" src="img/search.png" class="search-button" alt="虫眼鏡">
                        </div>
                    </form>
                </li>
                <li><a href=""><img src="img/button_post.png" class="post-button" name="post" alt="ポスト"></a></li>
                <div class="co">
                    <div class="user-container">
                        <li><a href=""><img src="img/icon_default.png" class="icon-img" name="icon" alt="アイコン"><span
                                    class="user-name">recoreco</span>
                                <ul class="dropdown-menu">
                                    <li><a href="/A2/MyPageServlet">マイページ</a></li>
                                    <li><a href="/A2/userManageServlet">ユーザ管理</a></li>
                                    <li><a href="/A2/LoginServlet">ログアウト</a></li>
                                </ul>
                            </a>
                        </li>

                    </div>
                </div>
            </ul>
        </nav>
    </header>
    <div class="flex">
        <img src="img/ffx.png" width="180px" height="200px" name="photo" alt="写真">
        <div class="column">
            <h1 class="big">FINAL FANTASY X</h1><input type="hidden" id="contentsId" value="${contentsId}">
            <h3>ゲーム</h3>
            <h3>2001年</h3>
            <h3>スクウェア</h3>
        </div>

        <nav class="bt">
            <button type="button" name="submit">
                <img src="img/point_chat.png" alt="チャットの画像">
                ランダムチャットを開始
            </button>
            <button type="button" name="submit" id="collectionBtn" value="1" onclick="goAjaxCollection()">
                <img src="img/point_plus.png" alt="追加の画像">
                コレクションに追加
            </button>
            <button type="button" name="submit" id="wishlistBtn" value="1" onclick="goAjaxWishlist()">
                <img src="img/point_plus.png" alt="追加の画像">
                ウィッシュリストに追加
            </button>
        </nav>
    </div>

    <p id="tabcontrol">
        <a href="#tabpage1">
            自分のレビュー
        </a>
        <a href="#tabpage2">
            他ユーザのレビュー
        </a>
    </p>

    <div id="tabbody">
        <div id="tabpage1" class="area selected">
            <select name="select2">
                <option value="all">並び替え</option>
                <option value="new">新しい順</span></option>
                <option value="old">古い順</span></option>
            </select>

            <div class="contents">
                <img src="img/ffx.png" class="image" width="180px" height="200px" alt="写真">
                <p>06/06 22:22 投稿</p>
                <button class="delete-button" onclick="deleteItem()">
                    <img src="img/garbage_can.png" class="delete-icon" width="20px" height="20px" alt="ゴミ箱">削除
                </button>
            </div>

            <h3 class="short">FINAL FANTASY X</h3>
            <div class="review">
                <p>オモロイ！！オモロイ！！オモロイ！！オモロイ！！オモロイ！！オモロイ！！オモロイ！！オモロイ！！オモロイ！！オモロイ！！</p>
            </div>
            <button class="delete-button1" onclick="deleteItem()">
                <img src="img/point_edit.png" class="delete-icon" width="20px" height="20px" alt="ゴミ箱">編集
            </button>
            <div class="heart" onclick="toggleHeartColor(this)">
                <span class="heart-count">0</span>
            </div>
            <img src="img/button_review.png" class="newreview" width="100px" height="100px" alt="新規レビューの写真">
        </div>

        <div id="tabpage2" class="area">
            <select name="select2">
                <option value="all">並び替え</option>
                <option value="new">新しい順</option>
                <option value="old">古い順</option>
            </select>
            <div class="contents1">
                <img src="img/ffx.png" class="image" width="180px" height="200px" alt="写真">
                <div class="namae">
                    <img src="img/login1.png" class="image1" width="40px" height="40px" alt="アイコン写真"><span
                        class="namae1">名前さん</span>
                </div>
                <p>06/06 22:22 投稿</p>

            </div>

            <h3 class="short">FINAL FANTASY X</h3>
            <div class="review">
                <p>オモロイ！！オモロイ！！オモロイ！！オモロイ！！オモロイ！！オモロイ！！オモロイ！！オモロイ！！オモロイ！！オモロイ！！</p>
            </div>
            <div class="heart2" onclick="toggleHeartColor(this)">
                <span class="heart-count">0</span>
            </div>
        </div>


    </div>

    <footer>
        <a href=#top><span class="gotop"></span></a>
        <p class="copyright">&copy; WAC</p>
    </footer>

    <script type="text/javascript">
        // ---------------------------
        // ▼A：対象要素を得る
        // ---------------------------
        var tabs = document.getElementById('tabcontrol').getElementsByTagName('a');
        var pages = document.getElementById('tabbody').getElementsByClassName('area');

        // ---------------------------
        // ▼B：タブの切り替え処理
        // ---------------------------
        function changeTab() {
            var targetid = this.getAttribute('href').substring(1);

            // 対象のタブページだけを表示する
            for (var i = 0; i < pages.length; i++) {
                if (pages[i].id === targetid) {
                    pages[i].classList.add('selected');
                } else {
                    pages[i].classList.remove('selected');
                }
            }

            // クリックされたタブにselectedクラスを追加し、他のタブから削除する
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('selected');
            }
            this.classList.add('selected');

            // ページ遷移しないようにfalseを返す
            return false;
        }

        // ---------------------------
        // ▼C：すべてのタブに対して、クリック時にchangeTab関数が実行されるよう指定する
        // ---------------------------
        for (var i = 0; i < tabs.length; i++) {
            tabs[i].onclick = changeTab;
        }

        // ---------------------------
        // ▼D：最初は先頭のタブを選択しておく
        // ---------------------------
        tabs[0].classList.add('selected');


        function goAjaxCollection() {

            //値を取得してくる
            let status = 1;
            let contentsId = document.getElementById('contentsId').value;
            let life = document.getElementById('collectionBtn').value;


            //{変数名：中に入れるもの}みたいに書いて、複数の値をpostData変数に格納
            let postData = { data1: status, data2: contentsId, data3: life }

            //非同期通信始めるよ
            $.ajaxSetup({ scriptCharset: 'utf-8' });
            $.ajax({
                //どのサーブレットに送るか
                //ajaxSampleのところは自分のプロジェクト名に変更する必要あり。
                url: '/A2/ApiMyContentsServlet',
                //どのメソッドを使用するか
                type: "POST",
                //受け取るデータのタイプ
                dataType: "json",
                //何をサーブレットに飛ばすか（変数を記述）
                data: postData,
                //この下の２行はとりあえず書いてる（書かなくても大丈夫？）
                processDate: false,
                timeStamp: new Date().getTime()
                //非同期通信が成功したときの処理
            }).done(function (data) {
                //成功した場合は、ボタンが反転する（同時に削除ボタンになる）
                if (data === "true") {
                    toggleCollection();
                    /* ボタンが反転する処理 */
                } else {
                    //失敗した場合はなにもしない
                }
            })
                //非同期通信が失敗したときの処理
                .fail(function () {
                    //失敗した場合はなにもしない
                });
        }


        function goAjaxWishlist() {

            //値を取得してくる
            let status = 0;
            let contentsId = document.getElementById('contentsId').value;
            let life = document.getElementById('wishlistBtn').value;


            //{変数名：中に入れるもの}みたいに書いて、複数の値をpostData変数に格納
            let postData = { data1: status, data2: contentsId, data3: life }

            //非同期通信始めるよ
            $.ajaxSetup({ scriptCharset: 'utf-8' });
            $.ajax({
                //どのサーブレットに送るか
                //ajaxSampleのところは自分のプロジェクト名に変更する必要あり。
                url: '/A2/ApiMyContentsServlet',
                //どのメソッドを使用するか
                type: "POST",
                //受け取るデータのタイプ
                dataType: "json",
                //何をサーブレットに飛ばすか（変数を記述）
                data: postData,
                //この下の２行はとりあえず書いてる（書かなくても大丈夫？）
                processDate: false,
                timeStamp: new Date().getTime()
                //非同期通信が成功したときの処理
            }).done(function (data) {
                //成功した場合は、ボタンが反転する（同時に削除ボタンになる）
                if (data === "true") {
                    toggleWishlist()
                    /* ここにボタンが反転する処理 */
                } else {
                    //失敗した場合はなにもしない
                }
            })
                //非同期通信が失敗したときの処理
                .fail(function () {
                    //失敗した場合はなにもしない
                });
        }





        function toggleCollection() {
            var collectionButton = document.getElementById('collectionBtn');
            if (collectionButton.innerText.includes('コレクションに追加')) {
                collectionButton.innerHTML = '<img src="img/point_delete.png" alt="削除の画像"> コレクションから削除';
                collectionButton.style.backgroundColor = '#ccc'; // 背景色をグレーに変更
            } else {
                collectionButton.innerHTML = '<img src="img/point_plus.png" alt="追加の画像"> コレクションに追加';
                collectionButton.style.backgroundColor = ''; // デフォルトに戻す
            }
        }


        function toggleWishlist() {
            var wishlistButton = document.getElementById('wishlistBtn');
            if (wishlistButton.innerText.includes('ウィッシュリストに追加')) {
                wishlistButton.innerHTML = '<img src="img/point_delete.png" alt="削除の画像"> <span style="font-size: 95%;">ウィッシュリストから削除</span>';
                wishlistButton.style.backgroundColor = '#ccc'; // 背景色をグレーに変更
            } else {
                wishlistButton.innerHTML = '<img src="img/point_plus.png" alt="追加の画像"> ウィッシュリストに追加';
                wishlistButton.style.backgroundColor = ''; // デフォルトに戻す
            }
        }






        let countTab1 = 0;
        let countTab2 = 0;

        function toggleHeartColor(heart) {
            var heartCount = heart.querySelector('.heart-count');

            if (heart.parentElement.id === 'tabpage1') {
                if (heart.classList.contains('clicked')) {
                    countTab1--;
                } else {
                    countTab1++;
                }
                heartCount.textContent = countTab1;
            } else if (heart.parentElement.id === 'tabpage2') {
                if (heart.classList.contains('clicked')) {
                    countTab2--;
                } else {
                    countTab2++;
                }
                heartCount.textContent = countTab2;
            }

            heart.classList.toggle('clicked');
        }
    </script>
</body>

</html>